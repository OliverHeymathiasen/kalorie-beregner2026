<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalorie- & Makroberegner</title>

  <!-- Font (t√¶ttere p√• ‚ÄúJames-feel‚Äù) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#214CA7;              /* din bl√• fra logo */
      --primary-2:#2C5BD0;
      --bg:#ffffff;
      --ink:#0B1B2B;                  /* m√∏rk navy */
      --muted:#667085;
      --line:#E6E8EC;
      --card:#ffffff;
      --soft:#F6F8FC;
      --shadow:0 14px 30px rgba(11,27,43,.08);
      --radius:14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--ink);
      background:linear-gradient(180deg,#fff 0%, #fff 65%, #F7F9FD 100%);
    }

    /* Topbar (James-ish) */
    .topbar{
      position:sticky; top:0; z-index:20;
      background:rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(230,232,236,.6);
    }
    .topbar-inner{
      max-width:980px;
      margin:0 auto;
      padding:14px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:.2px;
    }
    .brand-badge{
      width:34px; height:34px;
      border-radius:10px;
      background:rgba(33,76,167,.10);
      border:1px solid rgba(33,76,167,.18);
      display:grid; place-items:center;
      color:var(--primary);
      font-weight:900;
    }
    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(33,76,167,.22);
      background:rgba(33,76,167,.10);
      color:var(--primary);
      font-weight:700;
      text-decoration:none;
      user-select:none;
    }

    /* Layout */
    .wrap{max-width:980px;margin:0 auto;padding:22px 18px 80px}
    .panel{
      max-width:720px;
      margin:22px auto 0;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:26px 22px;
    }
    .center{text-align:center}
    h1{
      font-size:44px;
      line-height:1.05;
      margin:10px 0 10px;
      letter-spacing:-.8px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:16px;
      line-height:1.5;
    }
    .section-title{
      margin:26px 0 8px;
      font-size:20px;
      letter-spacing:-.2px;
    }
    .section-hint{
      margin:0 0 12px;
      color:var(--primary);
      font-weight:700;
      font-size:14px;
    }

    /* Cards */
    .cards{display:grid; gap:12px; margin-top:12px}
    .card{
      border:2px solid var(--line);
      border-radius:16px;
      padding:16px 16px;
      display:flex;
      gap:14px;
      align-items:center;
      cursor:pointer;
      background:#fff;
      transition:transform .06s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .card:hover{transform:translateY(-1px)}
    .card.active{
      border-color:rgba(33,76,167,.75);
      box-shadow:0 10px 24px rgba(33,76,167,.14);
      background:rgba(33,76,167,.06);
    }
    .icon{
      width:46px;height:46px;border-radius:14px;
      border:1px solid rgba(33,76,167,.18);
      background:rgba(33,76,167,.10);
      display:grid;place-items:center;
      color:var(--primary);
      flex:0 0 auto;
    }
    .card h3{margin:0;font-size:18px;letter-spacing:-.2px}
    .card p{margin:3px 0 0;color:var(--muted);font-size:14px}

    /* Two-up cards */
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:640px){ .grid2{grid-template-columns:1fr} h1{font-size:36px} }

    /* Slider blocks */
    .row{
      display:flex; align-items:flex-end; justify-content:space-between; gap:10px;
      margin-top:14px;
    }
    .label{font-weight:700}
    .value{
      font-weight:800;
      color:var(--primary);
      font-size:28px;
      letter-spacing:-.6px;
    }
    .unit{font-size:16px;font-weight:800;color:var(--primary); margin-left:4px}
    input[type="range"]{width:100%; margin-top:10px; accent-color: var(--primary);}
    .divider{height:1px;background:var(--line); margin:18px 0}

    /* Buttons */
    .actions{
      display:flex; gap:10px; margin-top:18px;
      justify-content:space-between;
    }
    .btn{
      width:100%;
      height:52px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--ink);
      font-weight:800;
      cursor:pointer;
    }
    .btn.primary{
      border-color:rgba(33,76,167,.3);
      background:linear-gradient(180deg, rgba(33,76,167,1) 0%, rgba(44,91,208,1) 100%);
      color:#fff;
      box-shadow:0 14px 28px rgba(33,76,167,.22);
    }
    .btn.primary:disabled{
      opacity:.55; cursor:not-allowed; box-shadow:none;
    }

    .btn-link{
      margin-top:10px;
      text-align:center;
      font-weight:700;
      color:var(--primary);
      cursor:pointer;
      user-select:none;
    }

    /* Result boxes */
    .result-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:14px;
    }
    @media (max-width:640px){ .result-grid{grid-template-columns:1fr} }
    .result-box{
      border-radius:16px;
      border:1px solid rgba(33,76,167,.18);
      background:rgba(33,76,167,.08);
      padding:16px 16px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .result-box .k{display:flex; gap:10px; align-items:center; color:var(--ink)}
    .result-box .k small{display:block; color:var(--muted); font-weight:700}
    .result-box .n{
      font-weight:900;
      color:var(--primary);
      font-size:30px;
      letter-spacing:-.7px;
    }

    /* Form */
    .form{
      margin-top:14px;
      display:grid;
      gap:12px;
    }
    .inputs2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:640px){ .inputs2{grid-template-columns:1fr} }
    .inp{
      height:52px;
      border-radius:12px;
      border:1px solid var(--line);
      padding:0 14px;
      font-size:16px;
      outline:none;
    }
    .inp:focus{border-color:rgba(33,76,167,.5); box-shadow:0 0 0 4px rgba(33,76,167,.12)}
    .consent{
      display:flex; gap:10px; align-items:flex-start;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }
    .consent input{margin-top:3px; width:18px; height:18px; accent-color:var(--primary)}
    .tiny{font-size:12px;color:var(--muted);margin-top:6px}

    /* Success box (James-ish) */
    .success{
      margin-top:14px;
      border-radius:18px;
      border:1px solid rgba(33,76,167,.18);
      background:rgba(33,76,167,.08);
      padding:18px;
      display:none;
    }
    .success .big{font-size:22px;font-weight:900; margin:6px 0}
    .success .small{color:var(--muted); margin:0}
    .check{
      width:58px;height:58px;border-radius:18px;
      background:#fff;
      border:1px solid rgba(33,76,167,.18);
      display:grid;place-items:center;
      box-shadow:0 10px 24px rgba(11,27,43,.08);
    }

    /* Step visibility */
    .step{display:none}
    .step.active{display:block}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-badge">OH</div>
        <div>Oliver Hey Fitness</div>
      </div>
      <a class="pill" href="#signup">Tilmeld</a>
    </div>
  </div>

  <div class="wrap">
    <div class="center">
      <h1>Kalorie- & Makroberegner</h1>
      <p class="sub">Baseret p√• den reviderede Harris-Benedict-formel</p>
    </div>

    <div class="panel">
      <!-- STEP 1 -->
      <section class="step active" id="step-1">
        <div class="section-title">Jeg vil gerne‚Ä¶</div>
        <p class="section-hint">V√¶lg det m√•l der passer bedst</p>

        <div class="cards" id="goalCards">
          <div class="card active" data-goal="recomp">
            <div class="icon" aria-hidden="true">
              <!-- simple svg -->
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M7 22h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M9 22V9a3 3 0 0 1 3-3h0a3 3 0 0 1 3 3v13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M8 10h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <h3>Opn√• en lavere fedtprocent og mere muskelmasse</h3>
              <p>Smid fedt og byg muskelmasse samtidig</p>
            </div>
          </div>

          <div class="card" data-goal="gain">
            <div class="icon" aria-hidden="true">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M7 14c2 0 2-2 4-2s2 2 4 2 2-2 4-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M6 15c0 4 3 7 6 7s6-3 6-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M9 6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <h3>Bygge muskelmasse</h3>
              <p>Tag muskelmasse p√• og bliv st√¶rkere</p>
            </div>
          </div>

          <div class="card" data-goal="lose">
            <div class="icon" aria-hidden="true">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M12 3v18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M7 8l5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 16h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <h3>Tabe fedt</h3>
              <p>Smid fedt og f√• mere overskud</p>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="to2">N√¶ste</button>
        </div>
      </section>

      <!-- STEP 2 -->
      <section class="step" id="step-2">
        <div class="section-title">Grundinfo</div>

        <div class="divider"></div>

        <div class="grid2" id="genderCards">
          <div class="card active" data-gender="female">
            <div class="icon">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M12 2a6 6 0 1 0 0 12a6 6 0 0 0 0-12Z" stroke="currentColor" stroke-width="2"/>
                <path d="M12 14v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M9 19h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <h3>Kvinde</h3>
              <p>Bruges til at beregne dit BMR</p>
            </div>
          </div>

          <div class="card" data-gender="male">
            <div class="icon">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M14 2h8v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M22 2l-8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M10 8a7 7 0 1 0 6 6" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            <div>
              <h3>Mand</h3>
              <p>Bruges til at beregne dit BMR</p>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="grid2" id="unitCards">
          <div class="card active" data-units="metric">
            <div class="icon">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M6 20V4h4v16H6Z" stroke="currentColor" stroke-width="2"/>
                <path d="M14 20V4h4v16h-4Z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            <div>
              <h3>Metrisk</h3>
              <p>cm / kg</p>
            </div>
          </div>
          <div class="card" data-units="imperial">
            <div class="icon">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                <path d="M4 7h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M6 7v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M10 7v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M14 7v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M18 7v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div>
              <h3>Imperial</h3>
              <p>ft/in / lbs</p>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="label">Alder</div>
          <div class="value"><span id="ageVal">35</span></div>
        </div>
        <input id="age" type="range" min="15" max="80" value="35">

        <div class="row">
          <div class="label">H√∏jde</div>
          <div class="value"><span id="heightVal">170</span><span class="unit" id="heightUnit"> cm</span></div>
        </div>
        <input id="height" type="range" min="140" max="210" value="170">

        <div class="row">
          <div class="label">V√¶gt</div>
          <div class="value"><span id="weightVal">100</span><span class="unit" id="weightUnit"> kg</span></div>
        </div>
        <input id="weight" type="range" min="40" max="200" value="100">

        <div class="actions">
          <button class="btn" id="back1">Tilbage</button>
          <button class="btn primary" id="to3">N√¶ste</button>
        </div>
      </section>

      <!-- STEP 3 -->
      <section class="step" id="step-3">
        <div class="section-title">Mit aktivitetsniveau er‚Ä¶</div>
        <p class="section-hint">V√¶lg det der passer bedst</p>

        <div class="cards" id="activityCards">
          <div class="card active" data-activity="1.375">
            <div>
              <h3>Let aktiv</h3>
              <p>Let tr√¶ning eller sport 1‚Äì3 dage/uge</p>
            </div>
          </div>

          <div class="card" data-activity="1.55">
            <div>
              <h3>Moderat aktiv</h3>
              <p>Tr√¶ning 3‚Äì5 dage/uge</p>
            </div>
          </div>

          <div class="card" data-activity="1.725">
            <div>
              <h3>Meget aktiv</h3>
              <p>H√•rd tr√¶ning 6‚Äì7 dage/uge</p>
            </div>
          </div>

          <div class="card" data-activity="1.9">
            <div>
              <h3>Ekstra aktiv</h3>
              <p>Meget h√•rd tr√¶ning + fysisk job / 2x tr√¶ning</p>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="back2">Tilbage</button>
          <button class="btn primary" id="calc">Beregn</button>
        </div>
      </section>

      <!-- STEP 4 -->
      <section class="step" id="step-4">
        <div class="section-title">Dine kalorier & protein</div>

        <div class="result-grid">
          <div class="result-box">
            <div class="k">
              <span aria-hidden="true">üî•</span>
              <div>
                <small>Kaloriem√•l</small>
                <div style="font-weight:900">kcal / dag</div>
              </div>
            </div>
            <div class="n" id="calOut">0</div>
          </div>

          <div class="result-box">
            <div class="k">
              <span aria-hidden="true">üçó</span>
              <div>
                <small>Proteinm√•l</small>
                <div style="font-weight:900">gram / dag</div>
              </div>
            </div>
            <div class="n" id="protOut">0g</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="label">Protein pr. kg</div>
          <div class="value"><span id="ppkVal">1.8</span><span class="unit"> g</span></div>
        </div>
        <input id="ppk" type="range" min="1.2" max="2.6" step="0.1" value="1.8">

        <div class="row">
          <div class="label">Kalorieunderskud</div>
          <div class="value"><span id="defVal">15</span><span class="unit">%</span></div>
        </div>
        <input id="deficit" type="range" min="0" max="30" step="1" value="15">

        <div class="divider"></div>

        <div class="section-title">Lad mig forklare‚Ä¶</div>
        <p class="sub" style="margin-top:8px">
          Jeg bliver n√∏dt til at forklare, hvorfor dette tal kan v√¶re anderledes end det, du har set i MyFitnessPal ‚Äì
          og hvorfor jeg ikke har givet dig et specifikt kulhydrat- eller fedtm√•l.
        </p>
        <p class="sub" style="margin-top:10px" id="signup">
          Skriv din bedste email herunder, s√• sender jeg min forklaring og holder dig opdateret ved at tilmelde dig min motiverende mail-liste üòä
        </p>

        <!-- Mailchimp JSONP form -->
        <form class="form" id="mcForm" novalidate>
          <div class="inputs2">
            <input class="inp" type="text" id="mcFname" placeholder="Fornavn (valgfrit)" autocomplete="given-name">
            <input class="inp" type="text" id="mcLname" placeholder="Efternavn (valgfrit)" autocomplete="family-name">
          </div>
          <input class="inp" type="email" id="mcEmail" placeholder="Email (p√•kr√¶vet)" autocomplete="email" required>

          <label class="consent">
            <input type="checkbox" id="mcConsent" checked>
            <span>Ja tak ‚Äì du m√• gerne sende mig emails med tips, tr√¶ning og tilbud. Du kan afmelde n√•r som helst.</span>
          </label>

          <button class="btn primary" id="mcSubmit" type="submit">Send</button>
          <div class="tiny" id="mcMsg"></div>
        </form>

        <div class="success" id="successBox">
          <div style="display:flex; gap:14px; align-items:center;">
            <div class="check" aria-hidden="true">
              <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
                <path d="M20 6L9 17l-5-5" stroke="var(--primary)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div>
              <div class="big">Tak! Du er tilmeldt üéâ</div>
              <p class="small">Hvis du ikke modtager mailen, s√• tjek gerne spam/u√∏nsket post.</p>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="back3">Tilbage</button>
          <button class="btn" id="restart">Start forfra</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ----------------------------
    // State
    // ----------------------------
    const state = {
      goal: "recomp",
      gender: "female",
      units: "metric",
      age: 35,
      heightCm: 170,
      weightKg: 100,
      activity: 1.375,
      proteinPerKg: 1.8,
      deficitPct: 15,
      calories: 0,
      protein: 0
    };

    // ----------------------------
    // Helpers
    // ----------------------------
    function setActive(container, el){
      [...container.querySelectorAll(".card")].forEach(c => c.classList.remove("active"));
      el.classList.add("active");
    }
    function showStep(n){
      [...document.querySelectorAll(".step")].forEach(s => s.classList.remove("active"));
      document.getElementById(`step-${n}`).classList.add("active");
      window.scrollTo({top:0, behavior:"smooth"});
    }
    function kgFromLbs(lbs){ return lbs * 0.45359237; }
    function cmFromIn(inch){ return inch * 2.54; }

    // Revised Harris-Benedict BMR
    // Male:   88.362 + 13.397*kg + 4.799*cm - 5.677*age
    // Female: 447.593 + 9.247*kg + 3.098*cm - 4.330*age
    function bmr({gender, kg, cm, age}){
      if(gender === "male"){
        return 88.362 + (13.397*kg) + (4.799*cm) - (5.677*age);
      }
      return 447.593 + (9.247*kg) + (3.098*cm) - (4.330*age);
    }

    function goalAdjustment(goal){
      // sm√•, fornuftige justeringer (du kan √¶ndre senere)
      // recomp: lille underskud, gain: lille overskud, lose: st√∏rre underskud
      if(goal === "gain") return { type:"surplus", pct: 8 };
      if(goal === "lose") return { type:"deficit", pct: 20 };
      return { type:"deficit", pct: 10 };
    }

    function compute(){
      const kg = state.weightKg;
      const cm = state.heightCm;

      const base = bmr({gender: state.gender, kg, cm, age: state.age});
      const tdee = base * state.activity;

      // Goal baseline
      const ga = goalAdjustment(state.goal);
      let target = tdee;

      if(ga.type === "surplus") target = tdee * (1 + ga.pct/100);
      if(ga.type === "deficit") target = tdee * (1 - ga.pct/100);

      // User deficit slider applies extra fine-tuning (0‚Äì30%)
      // For gain: deficit slider acts like "aggressiveness" but we clamp to not go under maintenance too much
      const d = state.deficitPct/100;
      if(state.goal === "gain"){
        target = Math.max(tdee * 0.95, target * (1 - (d*0.25))); // mild effect
      } else {
        target = target * (1 - d);
      }

      const calories = Math.round(target);
      const protein = Math.round(kg * state.proteinPerKg);

      state.calories = calories;
      state.protein = protein;

      document.getElementById("calOut").textContent = calories;
      document.getElementById("protOut").textContent = protein + "g";
    }

    // ----------------------------
    // Wire UI (Step 1)
    // ----------------------------
    const goalCards = document.getElementById("goalCards");
    goalCards.addEventListener("click", (e)=>{
      const card = e.target.closest(".card");
      if(!card) return;
      setActive(goalCards, card);
      state.goal = card.dataset.goal;
    });

    document.getElementById("to2").addEventListener("click", ()=> showStep(2));

    // ----------------------------
    // Step 2
    // ----------------------------
    const genderCards = document.getElementById("genderCards");
    genderCards.addEventListener("click",(e)=>{
      const card = e.target.closest(".card"); if(!card) return;
      setActive(genderCards, card);
      state.gender = card.dataset.gender;
    });

    const unitCards = document.getElementById("unitCards");
    unitCards.addEventListener("click",(e)=>{
      const card = e.target.closest(".card"); if(!card) return;
      setActive(unitCards, card);
      const newUnits = card.dataset.units;
      if(newUnits === state.units) return;

      // Convert current values when switching
      if(newUnits === "imperial"){
        // kg->lbs, cm->in (we keep internal in kg/cm but adjust sliders/ranges for user)
        state.units = "imperial";
        // slider values interpreted as imperial:
        // We'll map to common ranges; for simplicity keep current internal but update UI labels.
      } else {
        state.units = "metric";
      }
      updateUnitUI();
    });

    const age = document.getElementById("age");
    const height = document.getElementById("height");
    const weight = document.getElementById("weight");

    age.addEventListener("input", ()=>{
      state.age = +age.value;
      document.getElementById("ageVal").textContent = state.age;
    });

    function updateUnitUI(){
      const hu = document.getElementById("heightUnit");
      const wu = document.getElementById("weightUnit");
      const hv = document.getElementById("heightVal");
      const wv = document.getElementById("weightVal");

      if(state.units === "metric"){
        hu.textContent = " cm";
        wu.textContent = " kg";

        height.min = 140; height.max = 210; height.step = 1;
        weight.min = 40;  weight.max = 200; weight.step = 1;

        height.value = Math.round(state.heightCm);
        weight.value = Math.round(state.weightKg);

        hv.textContent = Math.round(state.heightCm);
        wv.textContent = Math.round(state.weightKg);
      } else {
        // Show imperial inputs, but store internal in kg/cm
        hu.textContent = " in";
        wu.textContent = " lbs";

        height.min = 55; height.max = 82; height.step = 1; // inches
        weight.min = 90; weight.max = 440; weight.step = 1; // lbs

        const inches = Math.round(state.heightCm / 2.54);
        const lbs = Math.round(state.weightKg / 0.45359237);

        height.value = inches;
        weight.value = lbs;

        hv.textContent = inches;
        wv.textContent = lbs;
      }
    }

    height.addEventListener("input", ()=>{
      if(state.units === "metric"){
        state.heightCm = +height.value;
        document.getElementById("heightVal").textContent = state.heightCm;
      } else {
        const inches = +height.value;
        state.heightCm = cmFromIn(inches);
        document.getElementById("heightVal").textContent = inches;
      }
    });

    weight.addEventListener("input", ()=>{
      if(state.units === "metric"){
        state.weightKg = +weight.value;
        document.getElementById("weightVal").textContent = state.weightKg;
      } else {
        const lbs = +weight.value;
        state.weightKg = kgFromLbs(lbs);
        document.getElementById("weightVal").textContent = lbs;
      }
    });

    document.getElementById("back1").addEventListener("click", ()=> showStep(1));
    document.getElementById("to3").addEventListener("click", ()=> showStep(3));

    // ----------------------------
    // Step 3
    // ----------------------------
    const activityCards = document.getElementById("activityCards");
    activityCards.addEventListener("click",(e)=>{
      const card = e.target.closest(".card"); if(!card) return;
      setActive(activityCards, card);
      state.activity = +card.dataset.activity;
    });

    document.getElementById("back2").addEventListener("click", ()=> showStep(2));
    document.getElementById("calc").addEventListener("click", ()=>{
      compute();
      showStep(4);
    });

    // ----------------------------
    // Step 4 sliders
    // ----------------------------
    const ppk = document.getElementById("ppk");
    const deficit = document.getElementById("deficit");

    ppk.addEventListener("input", ()=>{
      state.proteinPerKg = +ppk.value;
      document.getElementById("ppkVal").textContent = state.proteinPerKg.toFixed(1);
      compute();
    });

    deficit.addEventListener("input", ()=>{
      state.deficitPct = +deficit.value;
      document.getElementById("defVal").textContent = state.deficitPct;
      compute();
    });

    document.getElementById("back3").addEventListener("click", ()=> showStep(3));
    document.getElementById("restart").addEventListener("click", ()=>{
      // refresh for simplicity
      location.reload();
    });

    // ----------------------------
    // Mailchimp JSONP Signup (no redirect)
    // ----------------------------
    // Din action-URL fra Mailchimp embed:
    const mcAction = "https://me.us15.list-manage.com/subscribe/post?u=a8c95bb1bd295a68546d88267&id=1267d637b6&f_id=008bc2e1f0";

    function jsonp(url){
      return new Promise((resolve)=>{
        const cb = "mc_cb_" + Math.random().toString(16).slice(2);
        window[cb] = (data)=>{ resolve(data); script.remove(); delete window[cb]; };
        const script = document.createElement("script");
        script.src = url + "&c=" + cb;
        document.body.appendChild(script);
      });
    }

    document.getElementById("mcForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const msg = document.getElementById("mcMsg");
      const success = document.getElementById("successBox");

      msg.textContent = "";
      success.style.display = "none";

      const email = document.getElementById("mcEmail").value.trim();
      const fname = document.getElementById("mcFname").value.trim();
      const lname = document.getElementById("mcLname").value.trim();
      const consent = document.getElementById("mcConsent").checked;

      if(!email){
        msg.textContent = "Skriv en gyldig email üôÇ";
        return;
      }
      if(!consent){
        msg.textContent = "Du skal lige krydse af, f√∏r jeg m√• sende dig emails.";
        return;
      }

      // Mailchimp JSONP endpoint
      const jsonUrl = mcAction
        .replace("/subscribe/post?", "/subscribe/post-json?")
        .replace(/&amp;/g, "&");

      // Build params (include tag + calories)
      const params = new URLSearchParams();
      params.set("EMAIL", email);
      if(fname) params.set("FNAME", fname);
      if(lname) params.set("LNAME", lname);

      // Tag (som du sagde virker)
      params.set("tags", "Kalorieberegner 2026");

      // Gem kalorier i merge field "KALORIER"
      params.set("KALORIER", String(state.calories));

      // anti-bot field (tom)
      params.set("b_a8c95bb1bd295a68546d88267_1267d637b6", "");

      msg.textContent = "Sender‚Ä¶";

      try{
        const data = await jsonp(jsonUrl + "&" + params.toString());

        // Mailchimp svarer typisk med result: "success" eller "error"
        if(data.result === "success"){
          msg.textContent = "";
          success.style.display = "block";
          document.getElementById("mcForm").style.display = "none";
        } else {
          // hvis double opt-in er sl√•et til, kommer der ofte en ‚ÄúAlmost finished‚Ä¶‚Äù
          const raw = (data.msg || "").replace(/<[^>]*>/g,"").trim();
          if(raw.toLowerCase().includes("almost finished") || raw.toLowerCase().includes("confirm")){
            msg.textContent = "Tjek din indbakke og bekr√¶ft tilmeldingen (ogs√• spam/u√∏nsket).";
          } else if(raw.toLowerCase().includes("is already subscribed")){
            msg.textContent = "Du er allerede tilmeldt ‚úÖ";
          } else {
            msg.textContent = raw || "Der skete en fejl. Pr√∏v igen om lidt.";
          }
        }
      }catch(err){
        msg.textContent = "Der skete en fejl. Pr√∏v igen om lidt.";
      }
    });

    // init
    document.getElementById("ageVal").textContent = state.age;
    updateUnitUI();
  </script>
</body>
</html>
